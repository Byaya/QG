#QG手游组第四周周记
##生活随记
这个星期有点忙，离散考试和体育考试在两个星期后就要开始了，而且下周还有合唱比赛和两门选修考试。很不错，这一周过得很充实，虽然有点累，不过我的选修是素描，可以当做是一种放松的事情，合唱比赛是和班集体一起的，所以很快乐，而且这个星期的天气也不错，不会太热，虽然下着雨，总而言之，这个星期是愉快的一个星期
##本周学习
1、渲染流水线的各个阶段（简介）

（1）输入装配器阶段：
该阶段会从显存中读取几何数据（顶点、索引等），再将他们装配为图元

（2）顶点着色器阶段：
顶点着色器是一种输入与输出皆为单个顶点的函数，每个要被绘制的顶点都必须经过顶点着色器的处理

（3）曲面细分阶段：
曲面细分阶段是利用镶嵌化处理技术对网络中的三角形进行细分，以此来增加物体表面的三角形数量，使网格表现出更细腻的细节

（4）几何着色器阶段：
顶点着色器只能接受输入的单个顶点，经处理以后再将该顶点输出，而几何着色器可以将一个点或一条线扩展为一个四边形

（5）光栅化阶段：
光栅化阶段的主要任务是为投影主屏幕的3D三角形计算出对应像素的颜色

（6）像素着色器阶段：
像素着色器会对每一个像素片段（像素的采样点）进行处理，并根据顶点的插值属性作为输入来计算出对应的像素颜色

（7）输出合并阶段：
输出合并阶段会对像素片段进行深度缓冲区测试和模板缓冲区测试，然后选择性的丢弃一些像素片段，并选择性的将一些片段写入后台缓冲区中


2、常量缓冲区

常量缓冲区是一个用来存储各种变量的数据块，这些变量可以由着色器进行访问，着色器不能修改常量缓冲区中的内容，但是我们可以通过effect框架在c++应用程序代码运行时修改常量缓冲区中的内容。

3、顶点着色器

定义：顶点着色器是一组指令代码，这组代码在顶点被渲染时执行。同一时间内只能激活一个顶点着色器，每个顶点着色器可以拥有多条指令

作用：
（1）、顶点着色器可以提高场景渲染速度
（2）、用顶点着色器可以做布类仿真，高级别动画，实时修改透视效果，高级光亮等

流程：
（1）、创建顶点着色器
（2）、创建并绑定顶点布局
（3）、创建顶点数组
（4）、设置顶点缓冲区描述
（5）、新建顶点缓冲区


4、HLSL常量缓冲区打包规则

（1）、c++结构体数据是以字节流的形式传输到HLSL的

（2）、HLSL常量缓冲区中的向量不允许拆分

（3）、HLSL常量缓冲区中多个相邻的变量若有空缺则优先打包进同一个4D向量中（从上往下）

（4）、对于在常量缓冲区的结构体，也会进行打包操作

（5）、常量缓冲区中的数据一般都会被填充为4D向量

（6）、常量缓冲区中的数组中的每一个元素一般都会单独打包，但如果最后一个元素的后续
元素不是数组，就可以进行打包操作

（7）、若要使用数组，数组的每一个元素都必须是16字节对齐，结构体的大小也要是16字节
对齐

5、颜色向量和法向量

颜色向量通常表示为4D向量（red,green,blue,alpha）；
法向量用于表述物体表面的朝向，是单位向量，垂直于该表面

6、物体材质

不同的物体有不同的材质属性，这些不同的属性决定的该物体对各种颜色分量的反射系数
是多少。

7、光的种类

（1）环境光：间接光照，是光线经历了多次反射之后最终被人眼所见的光

（2）漫反射光：光照在粗糙表面的反射光

（3）镜面反射光：光照在光滑平面上的反射光

8、光照模型

（1）平行光

（2）点光

（3）聚光灯

9 、Geometry类（常用几何模型）：
（1）球体
（2）立方体
（3）圆柱体

10、顶点着色器和像素着色器补充

（1）顶点结构体成员若少于顶点着色器的输入签名，会不匹配

（2）顶点结构体成员若对于或等于顶点着色器的输入签名，匹配

（3）顶点结构体成员数量与顶点着色器的输入签名数量相同，但类型不匹配的话，有可能合法但会报错，也有可能不合法。

（4）像素着色器的输入必须和顶点着色器的输出精确匹配

（5）数据传送带：顶点结构体——》顶点着色器——》像素着色器

11、常量缓冲区补充

（1）定义：常量缓冲区是一种GPU资源，里面的数据内容可以供着色器程序引用

（2）常量缓冲区通常由CPU每帧更新一次，因此我们必须把常量缓冲区创建到一个上传堆中而不是默认堆中，这样才能让我们从CPU端更新常量

（3）更新常量缓冲区，首先要获得指向欲更新数据的指针，这一步可以使用Map方法，在常量缓冲区更新完毕之后，我们应该在映射内存之前进行Unmap（取消映射）操作。

（4）Map方法：三个参数，第一个参数：子资源索引，指定欲映射的子资源；第二个参数：描述了内存的映射范围（可选参数）；第三个参数：返回待映射资源数据的目标内存块

（5）Unmap方法：两个参数，第一个参数：子资源索引，指向了欲映射的子资源，第二个参数：描述取消映射的内存范围

12、常量缓冲区描述符作用：将常量缓冲区绑定到渲染流水线上

13、图形调试（多用几次就了解了）

1、为vs安装好必要的DirectX图形调试器，对着色器代码文件的属性进行一些更改，就完成准备工作了

2、截取一帧画面以后，可以停止收集，进入图形调试器主界面

3、在图形调试器的主界面中的事件列表中可以查看很多数据

4、主要使用图形调试进行着色器调试以此观察着色器的运行状态

杂项知识：

（1）求曲面的切面方程：多元函数各一阶导数构成的向量，将特定点的值代入，便是所求切面的法向量

（2）mul指令是乘法指令

（3）ID3DBlob接口：

作用：ID3DBlob接口继承自IUnknown接口，用于返回任意长度的数据

方法：主要有两个（1）GetBufferPointer()（2）GetBufferSzie()，分别用来检索指向blob的指针和指向blob数据的大小（以字节为单位
